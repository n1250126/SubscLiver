<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚µãƒ–ã‚¹ã‚¯ç®¡ç†</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      padding: 40px;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    h1 {
      margin: 0;
    }
    button {
      padding: 8px 14px;
      border: none;
      background: #3498db;
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
      margin-left: 5px;
    }
    button.danger {
      background: #e74c3c;
    }
    button:hover {
      opacity: 0.9;
    }
    .summary {
      background: #fff;
      padding: 15px 20px;
      border-radius: 8px;
      margin-top: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      font-size: 18px;
    }
    .chart-box {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    table {
      width: 100%;
      background: #fff;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 12px;
      border-bottom: 1px solid #ddd;
    }
    th {
      background: #f0f0f0;
      text-align: left;
    }
    .form-box {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .form-box h3 {
      margin-top: 0;
    }
    .form-box input, .form-box select {
      padding: 8px;
      margin-right: 10px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

  <header>
    <h1>ã‚µãƒ–ã‚¹ã‚¯ç®¡ç†ç”»é¢</h1>
    <button class="danger" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    <a href="pie-chart.html" class="button">ğŸ“Š å††ã‚°ãƒ©ãƒ•ã‚’è¦‹ã‚‹</a>
  </header>

  <!-- æœˆé¡åˆè¨ˆè¡¨ç¤º -->
  <div class="summary">
    æœˆé¡åˆè¨ˆé‡‘é¡ï¼š<strong id="monthlyTotal">Â¥0</strong>
  </div>

  <!-- ã‚°ãƒ©ãƒ•è¡¨ç¤º -->
  <div class="chart-box">
    <canvas id="subscriptionChart"></canvas>
  </div>

  <!-- è¿½åŠ  / ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ  -->
  <div class="form-box">
    <h3 id="formTitle">ã‚µãƒ–ã‚¹ã‚¯ã‚’è¿½åŠ </h3>
    <input type="text" id="service" placeholder="ã‚µãƒ¼ãƒ“ã‚¹å">
    <input type="number" id="price" placeholder="æ–™é‡‘" min="0">
    <select id="cycle">
      <option value="æœˆé¡">æœˆé¡</option>
      <option value="å¹´é¡">å¹´é¡</option>
    </select>
    <input type="date" id="nextBilling">
    <button onclick="saveSubscription()">ä¿å­˜</button>
    <button onclick="resetForm()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
  </div>

  <!-- ã‚µãƒ–ã‚¹ã‚¯ä¸€è¦§ -->
  <table>
    <thead>
      <tr>
        <th>ã‚µãƒ¼ãƒ“ã‚¹å</th>
        <th>æ–™é‡‘</th>
        <th>å‘¨æœŸ</th>
        <th>æ¬¡å›è«‹æ±‚æ—¥</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody id="subscriptionTable"></tbody>
  </table>

  <script>
    // ãƒ­ã‚°ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯
    if (localStorage.getItem("loggedIn") !== "true") {
      window.location.href = "login.html";
    }

    let subscriptions = JSON.parse(localStorage.getItem("subscriptions")) || [
      { service: "Netflix", price: 990, cycle: "æœˆé¡", nextBilling: "2026-03-01" },
      { service: "Spotify", price: 980, cycle: "æœˆé¡", nextBilling: "2026-02-15" }
    ];

    let editIndex = null;
    let chart = null;

    function renderTable() {
      const tbody = document.getElementById("subscriptionTable");
      tbody.innerHTML = "";

      subscriptions.forEach((sub, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${sub.service}</td>
          <td>Â¥${sub.price}</td>
          <td>${sub.cycle}</td>
          <td>${sub.nextBilling}</td>
          <td>
            <button onclick="editSubscription(${index})">ç·¨é›†</button>
            <button class="danger" onclick="deleteSubscription(${index})">å‰Šé™¤</button>
          </td>
        `;
        tbody.appendChild(row);
      });

      localStorage.setItem("subscriptions", JSON.stringify(subscriptions));
      updateMonthlyTotal();
      updateChart();
    }

    function updateMonthlyTotal() {
      let total = 0;
      subscriptions.forEach(sub => {
        if (sub.cycle === "æœˆé¡") {
          total += sub.price;
        } else if (sub.cycle === "å¹´é¡") {
          total += sub.price / 12;
        }
      });
      document.getElementById("monthlyTotal").textContent = "Â¥" + Math.round(total);
    }

    function getChartData() {
      const labels = [];
      const data = [];

      subscriptions.forEach(sub => {
        labels.push(sub.service);
        if (sub.cycle === "æœˆé¡") {
          data.push(sub.price);
        } else {
          data.push(Math.round(sub.price / 12));
        }
      });

      return { labels, data };
    }

    function updateChart() {
      const ctx = document.getElementById("subscriptionChart").getContext("2d");
      const chartData = getChartData();

      if (chart) {
        chart.destroy();
      }

      chart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: chartData.labels,
          datasets: [{
            label: "æœˆé¡ã‚³ã‚¹ãƒˆï¼ˆå††ï¼‰",
            data: chartData.data
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: value => "Â¥" + value
              }
            }
          }
        }
      });
    }

    function saveSubscription() {
      const service = document.getElementById("service").value.trim();
      const price = document.getElementById("price").value;
      const cycle = document.getElementById("cycle").value;
      const nextBilling = document.getElementById("nextBilling").value;

      if (!service || !price || !nextBilling) {
        alert("ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        return;
      }

      const newSub = { service, price: Number(price), cycle, nextBilling };

      if (editIndex === null) {
        subscriptions.push(newSub);
      } else {
        subscriptions[editIndex] = newSub;
        editIndex = null;
      }

      resetForm();
      renderTable();
    }

    function editSubscription(index) {
      const sub = subscriptions[index];
      document.getElementById("service").value = sub.service;
      document.getElementById("price").value = sub.price;
      document.getElementById("cycle").value = sub.cycle;
      document.getElementById("nextBilling").value = sub.nextBilling;

      document.getElementById("formTitle").textContent = "ã‚µãƒ–ã‚¹ã‚¯ã‚’ç·¨é›†";
      editIndex = index;
    }

    function deleteSubscription(index) {
      if (confirm("æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
        subscriptions.splice(index, 1);
        renderTable();
      }
    }

    function resetForm() {
      document.getElementById("service").value = "";
      document.getElementById("price").value = "";
      document.getElementById("cycle").value = "æœˆé¡";
      document.getElementById("nextBilling").value = "";
      document.getElementById("formTitle").textContent = "ã‚µãƒ–ã‚¹ã‚¯ã‚’è¿½åŠ ";
      editIndex = null;
    }

    function logout() {
      localStorage.removeItem("loggedIn");
      window.location.href = "login.html";
    }

    // åˆæœŸè¡¨ç¤º
    renderTable();
  </script>

</body>
</html>
